{% extends 'layout/layout_platform.html' %}

{% load staticfiles %}

{% block head %}
  <link href = "{% static 'css/device_manager/device_manager.css' %}" rel="stylesheet">

{% endblock %}

{% block content %}


  <!-- Content Wrapper. Contains page content -->
  <div class="content-wrapper">
    <!-- Content Header (Page header) -->
    <section class="content-header">
      <h1>
        Device Manager
        <small>Add, edit, or delete devices!</small>
      </h1>



      <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Level</a></li>
        <li class="active">Here</li>
      </ol>
    </section>

    <!-- Main content -->
    <section class="content">

      <!-- Your Page Content Here -->
        <!-- Horizontal Form -->

       <div class = "row">
            <div class="col-md-8">
                <div class="box box-success box-solid collapsed-box">
                    <div class="box-header with-border" id = "scanbox" data-widget="collapse">
                        <i id = "scanfafa" class="fa fa-wifi shake"></i>
                        <h3 class="box-title">Start a Scan</h3>
                          <!-- /.box-tools -->
                    </div>
                <!-- /.box-header -->
                <div class="box-body" id = "devicesfound">
                    <ul class="list-group" id =  "listdevicesfound">

                    </ul>


                </div>
                <div id = "loading">

                </div>
                <!-- /.box-body -->
              </div>
              <!-- /.box -->
        </div>
      </div>
      <div class = "row">
          <div class="col-md-10">
          <div class="box box-info device-box">
            <div class="box-header with-border">
              <h3 class="box-title">Your devices</h3>
            </div>
            <!-- /.box-header -->
            <!-- form start -->


            <li>

            <ul class="list-group">
              {% for device in listOfDevices %}
              <li class="list-group-item list-group-item-action">

                 <span class="pull-right">
                 <button name = "deviceId" value = "{{device.id}}" class="btn btn-danger btn-space" data-toggle = "modal" data-target="#modaldelete-{{device.id}}"><i class="fa fa-trash" aria-hidden="true"></i></button>
                 </span>

                 <div class = "modal fade" id = modaldelete-{{device.id}}>
                     <div class = "modal-dialog">
                         <div class = "modal-content">
                             <div class = "modal-header">
                                 <button type = "button" class = "close" type="close" data-dismiss = "modal">&times;</button>
                                 <h3 class = "modal-title"> Warning! </h3>
                             </div>
                             <form action = '{% url "deletedevice" %}' method = "post"> {% csrf_token %}
                                <div class = "modal-body">
                                    <h4> Are you sure you want to delete this device : {{ device }} </h4>
                                </div>
                            <div class = "modal-footer">
                                <a href = "" class ="btn btn-default" data-dismiss="modal">Cancel</a>
                                <button type="submit" name = "deviceId" value ="{{device.id}}" class = "btn btn-danger"> Delete! </button>
                            </div>
                            </form>
                         </div>
                     </div>
                 </div>


                 <span class="pull-right">
                 <button name = "deviceId" value = "{{device.id}}" class="btn btn-info btn-space" data-toggle = "modal" data-target="#modaledit-{{device.id}}"><i class="fa fa-pencil-square-o" aria-hidden="true"></i></button>
                 </span>

                 <div class="modal fade" id = "modaledit-{{device.id}}">
                    <div class =  "modal-dialog">
                        <div class = "modal-content">
                            <div class = "modal-header">
                                <button type = "button" class = "close" type="close" data-dismiss = "modal">&times;</button>
                                <h3 class = "modal-title"> Edit your device! </h3>
                            </div>
                            <form action = '{% url "devicemanager" %}' method = "post"> {% csrf_token %}
                            <div class = "modal-body">
                                <h4>{{ device }}</h4>
                                <p> Choose a new name : </p>
                                <div> {{ edit_device_form }} </div>
                            </div>
                            <div class = "modal-footer">
                                <a href = "" class ="btn btn-default" data-dismiss="modal">Cancel</a>
                                <button type="submit" name = "deviceId" value ="{{device.id}}" class = "btn btn-info"> Edit ! </button>
                            </div>
                            </form>

                        </div>
                    </div>
                 </div>

                 <span class="pull-right">
                     <a class="btn btn-success btn-space" href="/accounts/loggedin/devicemanager/{{device.id}}/"><i class="fa fa-cogs" aria-hidden="true"></i></a>
                 </span>




                 {% include "device_manager/modal_edit_device.html" %} <!--This is the pop up box that appears when editting device-->

                <h4 class = "list-group-item-heading">{{ device }}</h4>
                <p class="list-group-item-text"> {{ device.deviceNb }} </p>
                {% if device.deviceStatus == "Disconnected" %}
                  <form action = '/accounts/loggedin/devicemanager/{{device.id}}/connect/' method = "post"> {% csrf_token %}
                  <p class="deviceStatus"> {{device.deviceStatus}} <span class = "pull-right"><button type="submit" class = "btn btn-xs btn-default"> Reconnect </button></span></p>
                  </form>
                {% else %}
                  <form action = '/accounts/loggedin/devicemanager/{{device.id}}/disconnect/' method = "post"> {% csrf_token %}
                  <p class = "deviceStatus"> {{device.deviceStatus}} <span class = "pull-right"><button type="submit" class = "btn btn-xs btn-default"> Disconnect </button></span></p>
                  </form>
                {% endif %}

              </li>
              {% endfor %}
            </ul>
          </div>
          <!-- /.box -->
        </div>
      </div>



    </section>
    <!-- /.content -->
  </div>
  <!-- /.content-wrapper -->


{% endblock %}

{% block content1 %}
    <script src = "{% static 'js/device_manager/device_manager.js' %}"></script>
{% endblock content1 %}